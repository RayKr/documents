# 地下管廊管理平台前端架构

## 架构简介

现已逐步成型的地下管廊管理平台的前端监控页面，采用了B/S的Web架构，前后端技术分离，前后台数据交互使用Http+JSON的方式，前台页面上不负责业务逻辑处理，只负责与客户交互的视图层的数据展示、用户操作事件响应等，并将视图层数据传递给后台进行业务处理。

## 技术核心

### 项目采用的技术栈

`html`, `css`, `javascript`, `jquery`（及插件）, `vue`（数据绑定）, `pushlet`（数据推送）

### 页面整体架构

浏览器加载页面时，所有js, css, images等静态资源文件一次加载，当点击菜单打开不同的页面时，并未跳转新页面，而是将不同页面内容使用Ajax局部刷新技术动态加载在内容显示区域。即整个系统就是一个页面，共用所有静态文件，并且在登录系统时只加载一遍，对于后续的操作响应时长有很大提升；无刷新、无跳转的操作给用户操作友好性有所提升。

### 页面渲染数据绑定

使用Vue进行数据绑定操作。Vue实例在页面内容加载时使用ajax发起到后台的数据请求，接收到数据以后，通过vue本身特性进行页面渲染，页面DOM元素渲染完成后，重载jquery的事件绑定等。Vue是非侵入性的数据绑定，支持单向流和双向流，与jquery可配合使用。使用Vue渲染的页面，json中的数据变化，页面内容随之变化。对后续的数据推送起到便利作用。

同时，由于页面操作而引起的数据变动也可以更新在Vue的实例中，当需要传递到后台进行业务处理时，可直接从Vue实例中获取数据即可。

### 封装数据表格

结合项目本身需要和平台操作习惯，在`dataTables`的基础上又进行了自定义封装。其具备以下几个特性：

* 前端使用简便。统一书写方式，`$(selector).DrawTable(options);`
* 配置丰富。在表格的配置项中，可以配置后台请求表格数据的Action类、方法，参数，自定义表格工具栏按钮，按钮操作自定义提示文字等。并可以在后续平台完善过程中不断扩展功能。
* 支持自定义列。前台页面上不限定列，而是由后台Action类的编写过程中编写列。这样的好处是，当业务逻辑更改，前端页面程序无需改动，只需更改对应表格的Action类即可。
* 封装了基本的表格行记录的添加、修改、删除功能。同时支持前端自定义新增按钮。并且可使用jquery重载默认功能按钮的事件，保证灵活性。
* 支持添加、修改时form表单的自定义验证。整合jquery的form-validate校验插件到表格中，可在options中定义form表单的验证规则，写法与form-validate插件的api一致。

### 封装下拉列表框

在日常的平台开发及使用中，select下拉列表是个非常常用和重要的功能，需要满足后台枚举数据类型和自定义sql语句两种形式的远程数据加载。平台封装了简单易用的select书写方法：
```js
$('#equType').DrawSelect({
    "droptype": "sql",
    "enutype": "equtype",
    "defaultValue": ''
});
```
其具备以下几个特性：
* 支持枚举和sql。只需要指定`droptype`为`enu`或`sql`即可。
* 相同枚举默认加载在前台页面一次，再次使用相同枚举时是从页面缓存中获取。可减少前后台请求次数。
* 可指定select加载时的默认值。defaultValue字段如果不填，则无默认值；如果为空字符串，则增加一项空选项。
* 可指定是否强制刷新，即每次加载该select时都去请求数据库最新数据。该配置项在多个select级联功能中有用。

### 封装多个下拉列表的级联

封装了多个select下拉列表的级联关系，并且支持从后台获取数据，支持一次级联多个下拉列表。

### 封装图表

在百度echarts的基础上，结合项目实际需求，封装图表功能。实现前后台定义json格式数据，前台调用图表方法即可方便将数据生成图表，并且一份数据可支持柱状图和线形图切换。

## 系统架构分析

### 易用性

封装过程中，针对用户，本着符合操作规范的逻辑，页面元素简洁、美观；针对开发人员，本着最少代码、最少犯错原则，把页面渲染、展示、逻辑处理、事件响应等部分封装起来，只对开发人员提供可配置项，同时在配置项中又最大限度的提供可自定义性。

### 可扩展性

前后台分离，交互都使用统一的JSON格式和Http协议，所以保证良好的移植性和跨平台性。

开发过程中，许多涉及业务的变化的数据，都尽量采用数据库表记录配置项，这样在配置改动时，只需修改数据库中数据，而不必再过多修改项目代码。

前端的实现主要使用Vue和Jquery，两者可以互相配合，侵入性小，后续开发中既可以使用纯Vue，也可以使用纯Jquery，或者二者皆可。

### 健壮性



### 安全性


### 性能

## 当前架构还需改进的地方

